<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Halı Saha Bul</title>

  <!-- Leaflet Harita CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

  <style>
    body { margin:0; font-family: Arial, sans-serif; }
    #map { height: 90vh; }
    .topbar {
      background: #0b84ff; color: white; padding: 10px;
      display: flex; justify-content: space-between; align-items: center;
    }
    button {
      background: white; color:#0b84ff; border:none; border-radius:8px;
      padding:8px 12px; font-weight:bold; cursor:pointer;
    }
  </style>
</head>
<body>
  <div class="topbar">
    <h2>⚽ Halı Saha Bul</h2>
    <button id="addMatchBtn">Maç Oluştur</button>
  </div>

  <div id="map"></div>

  <!-- Firebase -->
  <script type="module">

    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyB8-N4sVBtxIoZqikRhGoXv86YU_9K8ecA",
  authDomain: "halisaha-1537c.firebaseapp.com",
  projectId: "halisaha-1537c",
  storageBucket: "halisaha-1537c.firebasestorage.app",
  messagingSenderId: "110810439295",
  appId: "1:110810439295:web:656f99f060ebfa88ba694a",
  measurementId: "G-QQH8205FB0"
};
    const firebaseConfig = {
      apiKey: "BURAYA_API_KEY",
      authDomain: "BURAYA_AUTH_DOMAIN",
      projectId: "BURAYA_PROJECT_ID",
      storageBucket: "BURAYA_STORAGE_BUCKET",
      messagingSenderId: "BURAYA_SENDER_ID",
      appId: "BURAYA_APP_ID"
    };

    // Firebase ve Firestore'u yükle
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, updateDoc, arrayUnion, doc } 
      from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Leaflet Harita
    const map = L.map('map').setView([41.0082, 28.9784], 11);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // Maçları Firestore'dan çek
    const maclarRef = collection(db, "maclar");
    onSnapshot(maclarRef, snapshot => {
      snapshot.docChanges().forEach(change => {
        const data = change.doc.data();
        const marker = L.marker([
          41.0082 + Math.random() * 0.02,
          28.9784 + Math.random() * 0.02
        ]).addTo(map);
        const katilanlar = data.katilanlar ? data.katilanlar.join(", ") : "Yok";
        marker.bindPopup(
          `<b>${data.saat}</b> - Eksik: ${data.eksik}<br>Katılanlar: ${katilanlar}<br><button onclick="katil('${change.doc.id}')">Katılıyorum</button>`
        );
      });
    });

    // Maç oluşturma
    document.getElementById("addMatchBtn").onclick = async () => {
      const saat = prompt("Maç saati nedir?");
      const eksik = prompt("Eksik pozisyon (ör: kaleci, defans vs)?");
      if (saat && eksik) {
        await addDoc(maclarRef, { saat, eksik, katilanlar: [] });
        alert("Maç eklendi!");
      }
    };

    // Katılma fonksiyonu
    window.katil = async (id) => {
      const isim = prompt("İsmini yaz:");
      if (!isim) return;
      const ref = doc(db, "maclar", id);
      await updateDoc(ref, { katilanlar: arrayUnion(isim) });
      alert("Maça katıldın!");
    };
  </script>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</body>
</html>
