<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HalÄ± Saha Bul</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #f9f9f9; text-align: center; }
    header { background: #2b6cb0; color: white; padding: 15px; font-size: 22px; }
    nav { display: flex; justify-content: center; gap: 10px; margin: 15px; flex-wrap: wrap; }
    button { padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
    button:hover { opacity: 0.9; }
    .primary { background: #3182ce; color: white; }
    .secondary { background: #e2e8f0; }
    section { display: none; }
    #map { height: 400px; margin: 10px auto; width: 90%; border-radius: 10px; }
    .card { background: white; margin: 10px auto; padding: 15px; width: 90%; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    input, select { padding: 8px; margin: 5px; width: 80%; border-radius: 6px; border: 1px solid #ccc; }
    h3 { margin-top: 0; }
  </style>
</head>
<body>
  <header>âš½ HalÄ± Saha Bul</header>
  <nav>
    <button class="secondary" onclick="showSection('bul')">HalÄ± Saha Bul</button>
    <button class="secondary" onclick="showSection('katil')">MaÃ§a KatÄ±l</button>
    <button class="primary" onclick="showSection('olustur')">MaÃ§ OluÅŸtur</button>
  </nav>

  <!-- HalÄ± Saha Bul -->
  <section id="bul">
    <div id="map"></div>
    <div id="macListesi"></div>
  </section>

  <!-- MaÃ§a KatÄ±l -->
  <section id="katil">
    <div id="katilListesi"></div>
  </section>

  <!-- MaÃ§ OluÅŸtur -->
  <section id="olustur">
    <div class="card">
      <h3>Yeni MaÃ§ OluÅŸtur</h3>
      <input id="saha" placeholder="HalÄ± Saha AdÄ± veya Adres" />
      <input id="saat" placeholder="Saat (Ã¶rnek: 20:00)" />
      <input id="eksik" placeholder="Eksik pozisyon (Ã¶rnek: kaleci)" />
      <input id="kackisi" type="number" placeholder="KaÃ§ kiÅŸi lazÄ±m?" />
      <button class="primary" onclick="macOlustur()">MaÃ§Ä± Kaydet</button>
    </div>
  </section>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-app.js";
    import { getFirestore, collection, getDocs, addDoc } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-firestore.js";

// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyB8-N4sVBtxIoZqikRhGoXv86YU_9K8ecA",
  authDomain: "halisaha-1537c.firebaseapp.com",
  projectId: "halisaha-1537c",
  storageBucket: "halisaha-1537c.firebasestorage.app",
  messagingSenderId: "110810439295",
  appId: "1:110810439295:web:656f99f060ebfa88ba694a",
  measurementId: "G-QQH8205FB0"
};

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // BÃ¶lÃ¼m geÃ§iÅŸi
    function showSection(id) {
      document.querySelectorAll("section").forEach(sec => sec.style.display = "none");
      document.getElementById(id).style.display = "block";
      if (id === "bul") maclariGetir();
    }
    showSection('bul');

    // Harita baÅŸlat
    const map = L.map('map').setView([41.0082, 28.9784], 11);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // MaÃ§ oluÅŸturma
    async function macOlustur() {
      const saha = document.getElementById('saha').value;
      const saat = document.getElementById('saat').value;
      const eksik = document.getElementById('eksik').value;
      const kackisi = document.getElementById('kackisi').value;

      if (!saha || !saat) return alert("LÃ¼tfen saha adÄ± ve saati girin!");

      await addDoc(collection(db, "maclar"), {
        saha, saat, eksik, kackisi, katilanlar: []
      });

      alert("MaÃ§ baÅŸarÄ±yla eklendi!");
      document.getElementById('saha').value = '';
      document.getElementById('saat').value = '';
      document.getElementById('eksik').value = '';
      document.getElementById('kackisi').value = '';
      showSection('bul'); // ekledikten sonra listeyi yenile
    }

    // MaÃ§larÄ± listele ve haritada gÃ¶ster
    async function maclariGetir() {
      const container = document.getElementById("macListesi");
      container.innerHTML = "";

      const snapshot = await getDocs(collection(db, "maclar"));
      snapshot.forEach(doc => {
        const mac = doc.data();
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <h3>${mac.saha}</h3>
          <p>ğŸ•’ Saat: ${mac.saat}</p>
          <p>ğŸ§¤ Eksik: ${mac.eksik || "Yok"}</p>
          <p>ğŸ‘¥ KiÅŸi lazÄ±m: ${mac.kackisi || "BelirtilmemiÅŸ"}</p>
        `;
        container.appendChild(card);

        // Haritada sahayÄ± iÅŸaretle (random koordinat)
        const lat = 41.0 + Math.random() * 0.1;
        const lng = 28.9 + Math.random() * 0.1;
        L.marker([lat, lng]).addTo(map).bindPopup(`<b>${mac.saha}</b><br>${mac.saat}`);
      });
    }
  </script>
</body>
</html>
