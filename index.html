<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>⚽ Halı Saha App</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<style>
body{font-family:Arial,sans-serif;margin:0;background:#f9f9f9;text-align:center;}
header{background:#2b6cb0;color:white;padding:15px;font-size:22px;}
nav{display:flex;justify-content:center;gap:10px;margin:15px;flex-wrap:wrap;}
button{padding:10px 20px;border:none;border-radius:8px;cursor:pointer;font-weight:bold;}
button:hover{opacity:0.9;}
.primary{background:#3182ce;color:white;}
.secondary{background:#e2e8f0;}
section{display:none;}
#map{height:400px;margin:10px auto;width:90%;border-radius:10px;}
.card{background:white;margin:10px auto;padding:15px;width:90%;border-radius:10px;box-shadow:0 2px 5px rgba(0,0,0,0.1);}
input,select{padding:8px;margin:5px;width:80%;border-radius:6px;border:1px solid #ccc;}
h3{margin-top:0;}
label{display:block;margin:5px;}
</style>
</head>
<body>

<header>⚽ Halı Saha App</header>

<!-- Login / Register -->
<section id="login">
  <div class="card">
    <h3>Giriş Yap / Kayıt Ol</h3>
    <input type="email" id="email" placeholder="Email" />
    <input type="password" id="password" placeholder="Şifre" />
    <button class="primary" id="loginBtn">Giriş Yap</button>
    <button class="secondary" id="registerBtn">Kayıt Ol</button>
  </div>
</section>

<!-- Ana sayfa -->
<section id="main">
  <nav>
    <button class="secondary" id="btnBul">Halı Saha Bul</button>
    <button class="secondary" id="btnKatil">Maça Katıl</button>
    <button class="primary" id="btnOlustur">Maç Oluştur</button>
    <button class="secondary" id="btnProfil">Profil / Maçlarım</button>
    <button class="secondary" id="btnLogout">Çıkış Yap</button>
  </nav>

  <!-- Halı Saha Bul -->
  <section id="bul">
    <label>İlçe filtrele:
      <select id="filtreIlce">
        <option value="">Tüm İlçeler</option>
        <option value="Kadıköy">Kadıköy</option>
        <option value="Beşiktaş">Beşiktaş</option>
        <option value="Şişli">Şişli</option>
        <option value="Bakırköy">Bakırköy</option>
      </select>
    </label>
    <label><input type="checkbox" id="filtreBosPozisyon"/> Sadece eksik pozisyonları göster</label>
    <div id="map"></div>
  </section>

  <!-- Maça Katıl -->
  <section id="katil">
    <label>İlçe filtrele:
      <select id="katilFiltreIlce">
        <option value="">Tüm İlçeler</option>
        <option value="Kadıköy">Kadıköy</option>
        <option value="Beşiktaş">Beşiktaş</option>
        <option value="Şişli">Şişli</option>
        <option value="Bakırköy">Bakırköy</option>
      </select>
    </label>
    <label><input type="checkbox" id="katilFiltreBosPozisyon"/> Sadece eksik pozisyonları göster</label>
    <div id="katilListesi"></div>
  </section>

  <!-- Maç Oluştur -->
  <section id="olustur">
    <div class="card">
      <h3>Yeni Maç Oluştur</h3>
      <input id="saha" placeholder="Halı Saha Adı" />
      <input id="ilce" placeholder="İlçe / Semt" />
      <input id="saat" placeholder="Saat (20:00)" />
      <input id="eksik" placeholder="Eksik pozisyon" />
      <input id="kackisi" type="number" placeholder="Kaç kişi lazım?" />
      <p>📍 Haritaya tıklayarak saha konumunu seçin</p>
      <button class="primary" id="kaydetBtn">Maçı Kaydet</button>
    </div>
  </section>

  <!-- Profil / Maçlarım -->
  <section id="profil">
    <h3>Maçlarım</h3>
    <div id="profilListesi"></div>
  </section>
</section>

<!-- Firebase ve Leaflet -->
<script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-auth.js"></script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
// Firebase config
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_AUTH_DOMAIN",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_STORAGE_BUCKET",
  messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
  appId: "YOUR_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();

// Global değişkenler
let currentUser = null;
let map = null;
let secilenMarker = null;
let secilenCoord = null;

// Login / Register
document.getElementById("loginBtn").onclick = async ()=>{
  const email=document.getElementById("email").value;
  const password=document.getElementById("password").value;
  try{
    const userCredential = await auth.signInWithEmailAndPassword(email,password);
    currentUser=userCredential.user;
    sessionStorage.setItem("userEmail",currentUser.email);
    initMain();
  }catch(e){alert("Giriş başarısız: "+e.message);}
}
document.getElementById("registerBtn").onclick = async ()=>{
  const email=document.getElementById("email").value;
  const password=document.getElementById("password").value;
  try{
    const userCredential = await auth.createUserWithEmailAndPassword(email,password);
    currentUser=userCredential.user;
    await db.collection("users").doc(currentUser.uid).set({email:currentUser.email});
    sessionStorage.setItem("userEmail",currentUser.email);
    initMain();
  }catch(e){alert("Kayıt başarısız: "+e.message);}
}

// Ana sayfa başlat
function initMain(){
  document.getElementById("login").style.display="none";
  document.getElementById("main").style.display="block";

  // Butonlar
  document.getElementById("btnBul").onclick=()=>showSection("bul");
  document.getElementById("btnKatil").onclick=()=>showSection("katil");
  document.getElementById("btnOlustur").onclick=()=>showSection("olustur");
  document.getElementById("btnProfil").onclick=()=>showSection("profil");
  document.getElementById("btnLogout").onclick=()=>logout();

  // Harita başlat
  if(!map){
    map=L.map('map').setView([41.0082,28.9784],11);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'&copy; OpenStreetMap contributors'}).addTo(map);
    map.on('click',function(e){
      if(secilenMarker) map.removeLayer(secilenMarker);
      secilenCoord=e.latlng;
      secilenMarker=L.marker(e.latlng).addTo(map).bindPopup("Seçilen Saha").openPopup();
    });
  }

  // Filtreler
  document.getElementById("filtreIlce").onchange = maclariGetir;
  document.getElementById("filtreBosPozisyon").onchange = maclariGetir;
  document.getElementById("katilFiltreIlce").onchange = maclariKatilGetir;
  document.getElementById("katilFiltreBosPozisyon").onchange = maclariKatilGetir;

  showSection("bul");
  maclariGetir();
}

// Logout
function logout(){auth.signOut();currentUser=null;sessionStorage.removeItem("userEmail");location.reload();}
function showSection(id){document.querySelectorAll("#main section").forEach(s=>s.style.display="none");document.getElementById(id).style.display="block";if(id==="bul") maclariGetir(); if(id==="katil") maclariKatilGetir(); if(id==="profil") profilGetir();}

// Maç oluştur
document.getElementById("kaydetBtn").onclick=async function(){
  const saha=document.getElementById("saha").value;
  const ilce=document.getElementById("ilce").value;
  const saat=document.getElementById("saat").value;
  const eksik=document.getElementById("eksik").value;
  const kackisi=document.getElementById("kackisi").value;
  if(!saha||!saat||!secilenCoord){return alert("Saha, saat ve konumu girin!");}
  await db.collection("maclar").add({saha,saat,eksik,kackisi,ilce,lat:secilenCoord.lat,lng:secilenCoord.lng,olusturan:currentUser.email,katilanlar:[]});
  alert("Maç kaydedildi!");
  document.getElementById("saha").value=''; document.getElementById("saat").value=''; document.getElementById("eksik").value=''; document.getElementById("kackisi").value=''; document.getElementById("ilce").value='';
  if(secilenMarker) map.removeLayer(secilenMarker); secilenCoord=null;
  showSection("bul");
}

// Fonksiyonlar: maclariGetir, maclariKatilGetir, profilGetir
async function maclariGetir(){
  const filtreIlce=document.getElementById("filtreIlce").value;
  const bosPozisyon=document.getElementById("filtreBosPozisyon").checked;
  map.eachLayer(l=>{if(l instanceof L.Marker) map.removeLayer(l);});
  const snapshot=await db.collection("maclar").get();
  snapshot.forEach(doc=>{
    const mac=doc.data();
    if((!filtreIlce||mac.ilce===filtreIlce)&&(!bosPozisyon||mac.eksik)){
      if(mac.lat && mac.lng){
        L.marker([mac.lat,mac.lng]).addTo(map).bindPopup(`<b>${mac.saha}</b><br>${mac.saat}<br>${mac.ilce}`);
      }
    }
  });
}

async function maclariKatilGetir(){
  const filtreIlce=document.getElementById("katilFiltreIlce").value;
  const bosPozisyon=document.getElementById("katilFiltreBosPozisyon").checked;
  const container=document.getElementById("katilListesi"); container.innerHTML="";
  const snapshot=await db.collection("maclar").get();
  snapshot.forEach(doc=>{
    const mac=doc.data();
    if((!filtreIlce||mac.ilce===filtreIlce)&&(!bosPozisyon||mac.eksik)){
      const card=document.createElement("div"); card.className="card";
      card.innerHTML=`<h3>${mac.saha}</h3><p>🕒 Saat: ${mac.saat}</p><p>🧤 Eksik: ${mac.eksik||"Yok"}</p><p>👥 Kişi lazım: ${mac.kackisi||"Belirtilmemiş"}</p><p>📍 İlçe: ${mac.ilce||"Belirtilmemiş"}</p><button class="primary">Katıl</button>`;
      container.appendChild(card);
      card.querySelector("button").onclick=async ()=>{
        if(!mac.katilanlar.includes(currentUser.email)){
          mac.katilanlar.push(currentUser.email);
          await db.collection("maclar").doc(doc.id).update({katilanlar:mac.katilanlar});
          alert("Maça katıldınız!"); maclariKatilGetir();
        } else { alert("Zaten katılmışsınız!"); }
      }
    }
  });
}

async function profilGetir(){
  const container=document.getElementById("profilListesi"); container.innerHTML="";
  const snapshot=await db.collection("maclar").get();
  snapshot.forEach(doc=>{
    const mac=doc.data();
    if(mac.olusturan===currentUser.email || mac.katilanlar.includes(currentUser.email)){
      const card=document.createElement("div"); card.className="card";
      card.innerHTML=`<h3>${mac.saha}</h3><p>🕒 Saat: ${mac.saat}</p><p>🧤 Eksik: ${mac.eksik||"Yok"}</p><p>👥 Kişi lazım: ${mac.kackisi||"Belirtilmemiş"}</p><p>📍 İlçe: ${mac.ilce||"Belirtilmemiş"}</p><p>🧑 Katılanlar: ${mac.katilanlar.join(", ")}</p><p>🔹 Oluşturan: ${mac.olusturan}</p>`;
      container.appendChild(card);
    }
  });
}
</script>

</body>
</html>


